<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Obejmy MaxMetal</title>
    <link rel="icon" href="../static/img/logo-male.png">
    <link rel="stylesheet" href="../static/style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>  <!-- Dodaj jQuery -->
<script>
   function filtrujMaterial() {
        let input = document.getElementById("szukaj_material").value.toLowerCase();
        let select = document.getElementById("nazwa_materiału");
        let options = select.getElementsByTagName("option");

        for (let option of options) {
            let text = option.textContent.toLowerCase();
            option.style.display = text.includes(input) ? "" : "none";
        }
    
    }


    function ustawMaksymalnaIlosc() {
    const select = document.getElementById("nazwa_materiału");
    const selectedOption = select.options[select.selectedIndex];
    const maxIlosc = selectedOption.getAttribute("data-max");
    
    const inputIlosc = document.getElementById("ilosc");
    inputIlosc.max = maxIlosc;
    inputIlosc.value = '';  // czyści pole ilości przy zmianie opcji
}
   function filtrujMateriale() {
        let input = document.getElementById("szukaj_materiale").value.toLowerCase();
        let select = document.getElementById("nazwa_materiał");
        let options = select.getElementsByTagName("option");

        for (let option of options) {
            let text = option.textContent.toLowerCase();
            option.style.display = text.includes(input) ? "" : "none";
        }
    
    }


    function ustawMaksymalnaIlosci() {
    const select = document.getElementById("nazwa_materiał");
    const selectedOption = select.options[select.selectedIndex];
    const maxIlosc = selectedOption.getAttribute("data-maxe");
    
    const inputIlosc = document.getElementById("ilosc");
    inputIlosc.max = maxIlosc;
    inputIlosc.value = '';  // czyści pole ilości przy zmianie opcji
}
</script>
</head>
<body>
    <div id="strona">
        <div id="banner">
            <div id="logo-banner">
                    <a href="{{ url_for('home') }}"><img id="logo-duże" src="../static/img/logo-duże.png" alt="logo"></a>
                </div>
        </div>

        <div id="test"></div><br>
        
        <form id="myForm" action="{{ url_for('dodaj_zlecenie_do_bazy') }}" method="post">
            
           
            <h2>Dodaj Zlecenie</h2>
            <label for="Nr_zamowienia">Nr zamówienia</label>
            <input type="text" name="Nr_zamowienia" required><br>
            <label for="nr_kartonu" name="nr_kartonu">Nr kartonu:</label>
            <input type="text" name="nr_kartonu" required><br>
            <label for="prodio" name="prodio">Nr Prodio:</label>
            <input type="text" name="prodio" required><br>
            
            
            
            <label for="imie">Imię i nazwisko:</label>
            <input type="text" name="imie" required><br>
            <!-- <label for="data">Data powrotu:</label>
            <input type="date" name="data" required><br> -->
            <label for="szukaj_material">Szukaj Piankę:</label>
<input type="text" id="szukaj_material" onkeyup="filtrujMaterial()" placeholder="Wpisz rozmiar.."><br>
<select id="nazwa_materiału" name="nazwa_materiału" required size="5" onchange="ustawMaksymalnaIlosc()">
    {% for nazwa_materiału in nazwy_materiału %}
    {% if nazwa_materiału.ilosc_na_stanie > 0 %}
        <option 
            value="{{ nazwa_materiału.id }}" 
            data-max="{{ nazwa_materiału.ilosc_na_stanie }}">
            {{ nazwa_materiału.nazwa }}ile: {{ nazwa_materiału.ilosc_na_stanie }}
        </option>
    {% endif %}
    {% endfor %}
</select>
<label for="ilosc_pianki" name="ilosc">Ilość pianki:</label>
            <input type="number" name="ilosc_pianki" required><br>
            <label for="szukaj_materiale">Szukaj Taśmę:</label>
<input type="text" id="szukaj_material" onkeyup="filtrujMateriale()" placeholder="Wpisz rozmiar.."><br>
<select id="nazwa_materiał" name="nazwa_materiał" required size="5" onchange="ustawMaksymalnaIlosci()">
    {% for nazwa_materiał in nazwy_materiał %}
    {% if nazwa_materiału.ilosc_na_stanie > 0 %}
        <option 
            value="{{ nazwa_materiał.id }}" 
            data-max="{{ nazwa_materiał.ilosc_na_stanie }}">
            {{ nazwa_materiał.nazwa }}ile: {{ nazwa_materiał.ilosc_na_stanie }}
        </option>
    {% endif %}
    {% endfor %}
</select>
<label for="ilosc_tasmy" name="ilosc_tasmy">Ilość taśmy:</label>
            <input type="number" name="ilosc_tasmy" required><br>
<div class="filter-controls">
  <label for="filter-from">Filtrowanie od:</label>
  <input type="date" id="filter-from">
  
  <label for="filter-to">Filtrowanie do:</label>
  <input type="date" id="filter-to">
  
  <button type="button" id="filter-btn">Filtruj</button>
  <button type="button" id="reset-filter">Resetuj</button>
</div><br>  
  <details id="detale">
  <summary>Obejmy:</summary>
  <div class="content scrollable-list">
    <ul>
      {% for nazwa_materiału in rozmiar %}
        {% if nazwa_materiału.ilosc_na_stanie > 0 %}
          <li>
            <label>
              <input 
                type="checkbox" 
                name="nazwa_materiału" 
                value="{{ nazwa_materiału.id }}" 
                data-waga-kregu="{{ nazwa_materiału.ilosc_na_stanie }}"
              >
              {{ nazwa_materiału.data }} na stanie: {{ nazwa_materiału.ilosc_na_stanie }}
              <input 
                type="number" 
                name="ilosc_{{ nazwa_materiału.id }}" 
                min="1" 
                max="{{ nazwa_materiału.ilosc_na_stanie }}" 
                placeholder="ilość"
              >
            </label>
          </li>
        {% endif %}
      {% endfor %}
    </ul>
  </div>
</details><br>   
            <button class="button" onclick="window.location.href='{{ url_for('zlecenie') }}'">Powrót</button>
            <button type="reset" class="button">Wyczyść</button>
            <button type="submit" class="button">Zapisz</button>
        </form>
    </div>
</body>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const fromDateInput = document.getElementById("filter-from");
  const toDateInput = document.getElementBy("filter-to");
  const filterBtn = document.getElementById("filter-btn");
  const resetBtn = document.getElementById("reset-filter");

  filterBtn.addEventListener("click", () => {
    const from = fromDateInput.value;
    const to = toDateInput.value;

    const items = document.querySelectorAll(".content li");

    items.forEach(item => {
      const text = item.textContent.trim();
      const match = text.match(/\d{4}-\d{2}-\d{2}/); // wyciąga datę z tekstu
      if (!match) return;

      const itemDate = match[0];

      const isAfterFrom = !from || itemDate >= from;
      const isBeforeTo = !to || itemDate <= to;

      if (isAfterFrom && isBeforeTo) {
        item.style.display = "";
      } else {
        item.style.display = "none";
      }
    });
  });

  resetBtn.addEventListener("click", () => {
    fromDateInput.value = "";
    toDateInput.value = "";
    document.querySelectorAll(".content li").forEach(item => {
      item.style.display = "";
    });
  });
});
</script>
</html>