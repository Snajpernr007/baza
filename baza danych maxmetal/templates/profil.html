<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile MaxMetal</title>
    <link rel="icon" href="../static/img/logo-duże.png">
    <link rel="stylesheet" href="../static/style.css">
    <script>
        // Odśwież stronę co 10 sekund
// setInterval(function() {
//     location.reload();
// }, 10000); // 10000 ms = 10 sekund

function filterTable() {
    let table = document.getElementById("tabela");
    let rows = table.querySelectorAll("tbody tr");
    let filters = table.querySelectorAll("thead tr:first-child input[type='text']");

    let dateFrom = document.getElementById("dateFrom")?.value;
    let dateTo = document.getElementById("dateTo")?.value;

    rows.forEach(row => {
        let cells = row.querySelectorAll("td");
        let show = true;

        // Filtrowanie tekstowe (kolumny poza "Data produkcji")
        filters.forEach((input, index) => {
            let value = input.value.toLowerCase();
            if (value && cells[index]) {
                let text = cells[index].textContent.toLowerCase();
                if (!text.includes(value)) {
                    show = false;
                }
            }
        });

        // Filtrowanie po dacie (kolumna 2 - Data Produkcji)
        if (show && (dateFrom || dateTo)) {
            let dateCell = cells[2]?.textContent.trim(); // Zakłada, że data jest w 3. kolumnie (indeks 2)
            if (dateCell) {
                let cellDate = new Date(dateCell);
                if (dateFrom && cellDate < new Date(dateFrom)) show = false;
                if (dateTo && cellDate > new Date(dateTo)) show = false;
            }
        }

        row.style.display = show ? "" : "none";
    });
}

// Funkcja do filtrowania na podstawie wpisywanego tekstu w danej kolumnie
function filterColumn(colIndex) {
    let table = document.getElementById("tabela");
    let rows = table.getElementsByTagName("tbody")[0].getElementsByTagName("tr");
    let filterValue = table.querySelectorAll("thead tr:nth-child(1) input")[colIndex].value.toLowerCase();

    for (let row of rows) {
        let cell = row.cells[colIndex];
        if (cell && cell.textContent.toLowerCase().indexOf(filterValue) > -1) {
            row.style.display = "";
        } else {
            row.style.display = "none";
        }
    }
}

// Zaktualizuj wywołanie funkcji filterTable w inputach
function setupFilters() {
    let table = document.getElementById("tabela");
    let filterInputs = table.querySelectorAll("thead tr:nth-child(1) input"); // tylko inputy z pierwszego wiersza

    filterInputs.forEach((input, index) => {
        input.addEventListener("keyup", function () {
            filterColumn(index); // teraz index będzie poprawny
        });
    });
}


// Wywołaj setupFilters po załadowaniu strony
document.addEventListener("DOMContentLoaded", setupFilters);
    function resetFilters() {
        let table = document.getElementById("tabela");
        let filterInputs = table.querySelectorAll("thead input");
        let rows = table.getElementsByTagName("tbody")[0].getElementsByTagName("tr");
    
        // Resetuj wszystkie pola filtrów
        filterInputs.forEach(input => input.value = "");
    
        // Przywróć widoczność wszystkich wierszy
        for (let i = 0; i < rows.length; i++) {
            rows[i].style.display = "";
        }
    }
    let sortStates = []; // Tablica przechowująca stan sortowania dla każdej kolumny
    
    function sortTable(columnIndex) {
        const table = document.getElementById("tabela");
        const rows = Array.from(table.rows).slice(2); // Pobieramy wszystkie wiersze poza nagłówkami
        const tbody = table.tBodies[0];
    
        // Sprawdzamy, czy kolumna już istnieje w tablicy sortStates
        const existingSortIndex = sortStates.findIndex(sort => sort.columnIndex === columnIndex);
    
        if (existingSortIndex !== -1) {
            // Jeśli kolumna jest już sortowana, zmieniamy jej kierunek
            sortStates[existingSortIndex].ascending = !sortStates[existingSortIndex].ascending;
        } else {
            // Jeśli kolumna nie jest jeszcze sortowana, dodajemy ją na początek tablicy
            sortStates.unshift({ columnIndex, ascending: true });
        }
    
        // Sortowanie wierszy na podstawie stanu w tablicy sortStates
        rows.sort((rowA, rowB) => {
            for (const sort of sortStates) {
                const cellA = rowA.cells[sort.columnIndex]?.innerText.toLowerCase() || "";
                const cellB = rowB.cells[sort.columnIndex]?.innerText.toLowerCase() || "";
    
                if (!isNaN(cellA) && !isNaN(cellB)) {
                    // Sortowanie liczb
                    const comparison = sort.ascending ? cellA - cellB : cellB - cellA;
                    if (comparison !== 0) return comparison;
                } else {
                    // Sortowanie tekstowe
                    const comparison = sort.ascending
                        ? cellA.localeCompare(cellB)
                        : cellB.localeCompare(cellA);
                    if (comparison !== 0) return comparison;
                }
            }
            return 0; // Jeśli wszystkie kolumny są równe, nie zmieniamy kolejności
        });
    
        // Przypisanie posortowanych wierszy do tabeli
        tbody.innerHTML = "";
        rows.forEach(row => tbody.appendChild(row));
    
        // Resetowanie strzałek i ustawienie odpowiednich w nagłówkach
        Array.from(table.tHead.rows[1].cells).forEach((cell, index) => {
            cell.innerHTML = cell.innerHTML.replace(/ ▲| ▼/g, '');
            const sortState = sortStates.find(sort => sort.columnIndex === index);
            if (sortState) {
                cell.innerHTML += sortState.ascending ? ' ▲' : ' ▼';
            }
        });
    }
    function openEditModal(row) {
    const cells = row.querySelectorAll("td");
    const editButton = row.querySelector("button");

    if (editButton.innerText === "Edytuj") {
        // Tworzenie tymczasowego wiersza do filtrowania
        const filterRow = document.createElement("tr");
        let filterCells = '';

        // Generowanie komórek do tymczasowego wiersza
        for (let i = 0; i < cells.length; i++) {
            if (i === 1) {
                filterCells += `<td><input type="text" placeholder="Filtruj Materiał" onkeyup="filterTasmy(this.value)" style="width: 100%;"></td>`;
            }else if (i === 10) {
                filterCells += `<td><input type="text" placeholder="Filtruj Długość" onkeyup="filterDlugosc(this.value)" style="width: 100%;"></td>`;
            } else {
                filterCells += `<td></td>`; // Puste komórki dla pozostałych kolumn
            }
        }

        filterRow.innerHTML = filterCells;
        row.parentElement.insertBefore(filterRow, row); // Wstaw wiersz filtrujący nad edytowany wiersz

        // Zamień edytowalne komórki na pola formularza
        cells.forEach((cell, index) => {
            if (index > 0 && index < cells.length - 3 && index !== 2 && index !== 3 && index !== 4) {
                if (index === 1) {
                    const currentTasmaId = cell.getAttribute("data-tasma-id");
                    cell.innerHTML = `<select style="width: 100%;" id="tasmaSelect"></select>`;
                    populateTasma(cell.querySelector("#tasmaSelect"), currentTasmaId);
                } else if (index === 5) { // Weight fields
                    const value = cell.innerText;
                    cell.innerHTML = `<input type="number" value="${value}" step="0.01" style="width: 100%;">`;
                }else if (index === 10) { // Weight fields
                    const currentDlugoscId = cell.getAttribute("data-dlugosci-id");
            cell.innerHTML = `<select style="width: 100%;" id="dlugosciSelect"></select>`;
            populateDlugosci(cell.querySelector("#dlugosciSelect"), currentDlugoscId);} else {
                    const value = cell.innerText;
                    cell.innerHTML = `<input type="text" value="${value}" style="width: 100%;">`;
                }
            }
        });

        editButton.innerText = "Zapisz";
    } else if (editButton.innerText === "Zapisz") {
        // Zbierz dane z formularza
        const updatedData = {};
        let isValid = true;

        cells.forEach((cell, index) => {
            if (index > 0 && index < cells.length - 3 && index !== 2 && index !== 3 && index !== 4) {
                const input = cell.querySelector("input") || cell.querySelector("select");
                if (input) {
                    const value = input.value.trim();
                    if (!value) {
                        isValid = false; // Walidacja: sprawdź, czy pole nie jest puste
                    } else {
                        updatedData[`column_${index}`] = value; // Dodaj do danych do wysłania
                        cell.innerText = value; // Zapisz nowe wartości
                    }
                }
            } else if (index === 0 || index >= cells.length - 4) {
                updatedData[`column_${index}`] = cell.innerText; // Zapisz ID i inne wartości
            }
        });

        if (isValid) {
            sendDataToBackenda(updatedData);
            editButton.innerText = "Edytuj";
            
            // Usunięcie tymczasowego wiersza po zapisaniu
            const nextRow = row.previousElementSibling; // Wiersz filtrujący jest bezpośrednio nad edytowanym wierszem
            if (nextRow) {
                nextRow.remove(); // Usuń wiersz filtrujący po zapisaniu
            }
        } else {
            alert("Proszę wypełnić wszystkie edytowalne pola.");
        }
    }
}
function sendDataToBackenda(data) {
    console.log("Dane wysyłane do backendu:", data);
    fetch('/update-row_profile', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`Błąd HTTP: ${response.status}`);
        }
        return response.json();
    })
    .then(result => {
        console.log("Odpowiedź backendu:", result);
        
    })
    .catch(error => {
        console.error("Błąd podczas wysyłania danych:", error.message);
        alert(`Błąd: ${error.message}`);
    });
}
    function openEditModala(row) {
    const cells = row.querySelectorAll("td");
    const editButton = row.querySelector("button");

    if (editButton.innerText === "Edytuj") {
        // Tworzenie tymczasowego wiersza do filtrowania
        const filterRow = document.createElement("tr");
        let filterCells = '';

        // Generowanie komórek do tymczasowego wiersza
        for (let i = 0; i < cells.length; i++) {
            if (i === 1) {
                filterCells += `<td><input type="text" placeholder="Filtruj Materiał" onkeyup="filterTasmy(this.value)" style="width: 100%;"></td>`;
            }else if (i === 10) {
                filterCells += `<td><input type="text" placeholder="Filtruj Długość" onkeyup="filterDlugosc(this.value)" style="width: 100%;"></td>`;
            }else if (i ===6) {
                filterCells += `<td><input type="text" placeholder="Filtruj Nr części klienta" onkeyup="filterSzablon_profile(this.value)" style="width: 100%;"></td>`;
            }else {
                filterCells += `<td></td>`; // Puste komórki dla pozostałych kolumn
            }
        }

        filterRow.innerHTML = filterCells;
        row.parentElement.insertBefore(filterRow, row); // Wstaw wiersz filtrujący nad edytowany wiersz

        // Zamień edytowalne komórki na pola formularza
        cells.forEach((cell, index) => {
    if (index > 0 && index < cells.length - 3 && index != 3) {
        if (index === 1) {
            const currentTasmaId = cell.getAttribute("data-tasma-id");
            cell.innerHTML = `<select style="width: 100%;" id="tasmaSelect"></select>`;
            populateTasma(cell.querySelector("#tasmaSelect"), currentTasmaId);
        } else if (index === 2 ) { // Data fields
            const value = cell.innerText;
            cell.innerHTML = `<input type="date" value="${value}" style="width: 100%;">`;
        } else if (index === 6 ) { // Weight fields
            const value = cell.innerText;
            cell.innerHTML = `<input type="number" value="${value}" step="0.01" style="width: 100%;">`;
        }else if (index === 7  ) { // Weight fields
            const currentSzablon_profileId = cell.getAttribute("data-szblon_profile-id");
            cell.innerHTML = `<select style="width: 100%;" id="szablon_profileSelect"></select>`;
            populateSzablon_profile(cell.querySelector("#szablon_profileSelect"), currentSzablon_profileId);
        }else if (index === 4 || index==5 ) { // Weight fields
            const value = cell.innerText;
            cell.innerHTML = `<input type="time" value="${value}" step="2" style="width: 100%;">`;
        }else if (index ===11 ) { // Weight fields
            const currentDlugoscId = cell.getAttribute("data-dlugosci-id");
            cell.innerHTML = `<select style="width: 100%;" id="dlugosciSelect"></select>`;
            populateDlugosci(cell.querySelector("#dlugosciSelect"), currentDlugoscId);}
         else {
            const value = cell.innerText;
            cell.innerHTML = `<input type="text" value="${value}" style="width: 100%;">`;
        }
    }
});
        editButton.innerText = "Zapisz";
    } else if (editButton.innerText === "Zapisz") {
        // Zbierz dane z formularza
        const updatedData = {};
        let isValid = true;

        cells.forEach((cell, index) => {
            if (index > 0 && index < cells.length - 3 && index != 3) { 
                const input = cell.querySelector("input") || cell.querySelector("select");
                if (input) {
                    const value = input.value.trim();
                    if (!value) {
                        isValid = false; // Walidacja: sprawdź, czy pole nie jest puste
                    } else {
                        updatedData[`column_${index}`] = value; // Dodaj do danych do wysłania
                        cell.innerText = value; // Zapisz nowe wartości
                    }
                }
            } else if (index === 0 || index >= cells.length - 4) {
                updatedData[`column_${index}`] = cell.innerText; // Zapisz ID i inne wartości
            }
        });

        if (isValid) {
            sendDataToBackend(updatedData);
            editButton.innerText = "Edytuj";

            // Usunięcie tymczasowego wiersza po zapisaniu
            const nextRow = row.previousElementSibling; // Wiersz filtrujący jest bezpośrednio nad edytowanym wierszem
            if (nextRow) {
                nextRow.remove(); // Usuń wiersz filtrujący po zapisaniu
            }
        } else {
            alert("Proszę wypełnić wszystkie edytowalne pola.");
        }
    }
}






// Funkcja do pobierania dostawców
function populateTasma(selectElement, selectedValue) {
    fetch('/get-tasma')
        .then(response => response.json())
        .then(data => {
            data.forEach(tasma => {
                const option = document.createElement('option');
                option.value = tasma.id;
                option.textContent = tasma.nr_z_etykiety_na_kregu;
                selectElement.appendChild(option);
            });

            if (selectedValue) {
                selectElement.value = selectedValue;
            }
        })
        .catch(error => console.error('Błąd podczas pobierania tasmy:', error));
}


function filterTasmy(searchTerm) {
    const select = document.getElementById("tasmaSelect");
    const options = select.options;

    for (let i = 0; i < options.length; i++) {
        const optionText = options[i].text.toLowerCase();
        options[i].style.display = optionText.includes(searchTerm.toLowerCase()) ? "" : "none";
    }
}
function populateDlugosci(selectElement, selectedValue) {
    fetch('/get-dlugosci')
        .then(response => response.json())
        .then(data => {
            data.forEach(dlugosci => {
                const option = document.createElement('option');
                option.value = dlugosci.id;
                option.textContent = dlugosci.nazwa;
                selectElement.appendChild(option);
            });

            if (selectedValue) {
                selectElement.value = selectedValue;
            }
        })
        .catch(error => console.error('Błąd podczas pobierania dlugosci:', error));
}


function filterDlugosc(searchTerm) {
    const select = document.getElementById("dlugosciSelect");
    const options = select.options;

    for (let i = 0; i < options.length; i++) {
        const optionText = options[i].text.toLowerCase();
        options[i].style.display = optionText.includes(searchTerm.toLowerCase()) ? "" : "none";
    }
}
function populateSzablon_profile(selectElement, selectedValue) {
    fetch('/get-szablon_profile')
        .then(response => response.json())
        .then(data => {
            data.forEach(szablon_profile => {
                const option = document.createElement('option');
                option.value = szablon_profile.id;
                option.textContent = szablon_profile.nazwa;
                selectElement.appendChild(option);
            });

            if (selectedValue) {
                selectElement.value = selectedValue;
            }
        })
        .catch(error => console.error('Błąd podczas pobierania szablou profilu:', error));
}


function filterSzablon_profile(searchTerm) {
    const select = document.getElementById("szablon_profileSelect");
    const options = select.options;

    for (let i = 0; i < options.length; i++) {
        const optionText = options[i].text.toLowerCase();
        options[i].style.display = optionText.includes(searchTerm.toLowerCase()) ? "" : "none";
    }
}
function sendDataToBackend(data) {
    
    console.log("Wysyłanie danych:", data); // Dodaj to
    fetch('/update-row_profil', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
    })
    .then(response => response.json())
    .then(result => {
        console.log("Wynik z backendu:", result);
        alert("Dane zostały pomyślnie zapisane!");
    })
    .catch(error => {
        console.error("Błąd podczas wysyłania danych:", error);
        alert("Wystąpił błąd podczas zapisywania danych!");
    });
    
}
function openMultipleWindows() {
        // URL, który ma być otwierany w nowych oknach
        const url = "{{ url_for('dodaj_profil') }}"; // Podmień na odpowiedni URL

// Parametry dla każdego nowego okna
const windowFeatures = 'width=800,height=600,scrollbars=yes,menubar=no,toolbar=no,status=no'; 

// Otwieranie nowego okna za każdym razem, gdy klikniesz w etykietę
window.open(url, '_blank', windowFeatures); // '_blank' otworzy nowe okno/tab
    }
</script>
</head>
<body>
    <div id="strona">
        <div id="banner">
            <div id="menu-main">
                <nav role="navigation">
                    <div id="menuToggle">
                        <input type="checkbox" id="menuCheckbox">

                        <span></span>
                        <span></span>
                        <span></span>

                        <ul id="menu">
                            {% if not g.user %}
                        
                            <li>
                                <a href="{{ url_for('login') }}"><label for="menuCheckbox" onclick="this.parentNode.click();">Zaloguj się!</label></a>
                            </li>
                        
                            
                        {% else %}
                        <li>
                            <a href="{{ url_for('logout') }}"><label for="menuCheckbox" onclick="this.parentNode.click();">Wyloguj się</label></a>
                        </li>
                        {% endif %}
                        {%if g.user.id_uprawnienia==1 or g.user.id_uprawnienia==2%}
                        <li>
                            <a href="{{ url_for('tasma') }}"><label for="menuCheckbox" onclick="this.parentNode.click();">Materiały</label></a>
                        </li>
                        {% endif %}
                        
                        {% if g.user.id_uprawnienia==1 %}
                        <li>
                            <a href="{{ url_for('uzytkownik') }}"><label for="menuCheckbox" onclick="this.parentNode.click();">Uzytkownicy</label></a>
                        </li>
                        {% endif %}
                        {% if g.user.id_uprawnienia==1 or g.user.id_uprawnienia==2%}
                        <li>
                            <a href="{{ url_for('dostawcy') }}"><label for="menuCheckbox" onclick="this.parentNode.click();">Dostawcy</label></a>
                        </li>
                        {% endif %}
                        {% if g.user.id_uprawnienia==1 or g.user.id_uprawnienia==2%}
                        <li>
                            <a href="{{ url_for('szablon') }}"><label for="menuCheckbox" onclick="this.parentNode.click();">Nazwy</label></a>
                        </li>
                        {% endif %}
                        {% if g.user.id_uprawnienia==1 or g.user.id_uprawnienia==2%}
                        <li>
                            <a href="{{ url_for('lokalizacja') }}"><label for="menuCheckbox" onclick="this.parentNode.click();">Magazyny</label></a>
                        </li>
                        {% endif %}
                        {% if g.user.id_uprawnienia==1 or g.user.id_uprawnienia==2%}
                        <li>
                            <a href="{{ url_for('dlugosci') }}"><label for="menuCheckbox" onclick="this.parentNode.click();">Długości</label></a>
                        </li>
                        {% endif %}
                        {% if g.user.id_uprawnienia==1 or g.user.id_uprawnienia==2%}
                        <li>
                            <a href="{{ url_for('szablon_profil') }}"><label for="menuCheckbox" onclick="this.parentNode.click();">Nazwy profili</label></a>
                        </li>
                        {% endif %}
                        {% if g.user.id_uprawnienia==1 %}
                        <li>
                            <a href="{{ url_for('zestawienie') }}"><label for="menuCheckbox" onclick="this.parentNode.click();">Zestawienie</label></a>
                        </li>
                        {% endif %}
                        {% if g.user.id_uprawnienia==1 or g.user.id_uprawnienia==2%}
                        <li>
                            <a href="{{ url_for('sprzedaz') }}"><label for="menuCheckbox" onclick="this.parentNode.click();">Sprzedaż</label></a>
                        </li>
                        {% endif %}
                        <li>
                            <a href=javascript:history.back();><label for="menuCheckbox" onclick="this.parentNode.click();">Powrót</label></a>
                        </li>
                        <li>
                            <label style="cursor: pointer;" onclick="openMultipleWindows();">Dodaj Profil</label>
                        </li>
                            
                            <li>
                                <img id="logo1" src="../static/img/logo-duże.png" alt="logo">
                            </li>
                        </ul>   
                    </div>
                </nav>
                <div id="logo-banner">
                    <a href="{{ url_for('home') }}"><img id="logo-duże" src="../static/img/logo-duże.png" alt="logo"></a>
                </div>
                
            </div>
        </div>
        <div id="content">
            <div id="title">
                {% if user %}
                <h2 id="witaj">Witaj, {{ user.login }}!</h2>    
            {% endif %}
            
            </div>
            <hr>
            <div>
                <table id="tabela">
                    <thead>
                        <tr>
                            <th><input type="text" placeholder="Filtruj ID" ></th>
                            <th><input type="text" placeholder="Filtruj Materiał" ></th>
                            <th>OD<input type="date" id="dateFrom" onchange="filterTable()">
                                DO<input type="date" id="dateTo" onchange="filterTable()"></th>
                            <th><input type="text" placeholder="Filtruj Godzinę rozpoczęcia" ></th>
                            <th><input type="text" placeholder="Filtruj Godzinę zakończenia" ></th>
                            <th><input type="text" placeholder="Filtruj Zwrot na magazyn" ></th>
                            <th><input type="text" placeholder="Filtruj Nr części Klienta" ></th>
                            <th><input type="text" placeholder="Filtruj Nazwę klienta Nr PRODIO" ></th>
                            <th><input type="text" placeholder="Filtruj Ilość" ></th>
                            <th><input type="text" placeholder="Filtruj Ilość na stanie" ></th>
                            <th><input type="text" placeholder="Filtruj Długość" ></th>
                            <th><input type="text" placeholder="Filtruj Rodzaj Materiału" ></th>
                            <th><input type="text" placeholder="Filtruj Nazwę Stanowiska i imie i nazwisko"  ></th>
                            
                            <th><button class="button" onclick="resetFilters()">Usuń Filtry</button></th>
                        </tr>
                        <tr>
                            <th onclick="sortTable(0)">ID &#9650;&#9660;</th>
                            <th onclick="sortTable(1)">Etykieta Materiału &#9650;&#9660;</th>
                            <th onclick="sortTable(2)">Data Produkcji &#9650;&#9660;</th>
                            
                            <th onclick="sortTable(3)">Godzina rozpoczęcia &#9650;&#9660;</th>
                            <th onclick="sortTable(4)">Godzina zakończenia &#9650;&#9660;</th>
                            <th onclick="sortTable(5)">Zwrot na magazyn kg &#9650;&#9660;</th>
                            <th onclick="sortTable(6)">Nr części klienta &#9650;&#9660;</th>
                            <th onclick="sortTable(7)">Nazwa klienta Nr PRODIO &#9650;&#9660;</th>
                            <th onclick="sortTable(8)">Ilość &#9650;&#9660;</th>
                            <th onclick="sortTable(9)">Ilość na stanie &#9650;&#9660;</th>
                            <th onclick="sortTable(10)">Długość &#9650;&#9660;</th>
                            <th onclick="sortTable(11)">Rodzaj materiału &#9650;&#9660;</th>
                            <th onclick="sortTable(12)">Nazwa Stanowiska i imie i nazwisko &#9650;&#9660;</th>
                            
                            <th>Edycja</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for profile in profil %}
                            
                        {% if g.user.id_uprawnienia == 3 and profile.pracownik.login == g.user.login %}
                        {% if profile.data_produkcji.strftime('%Y-%m-%d') in [currentDate, currentDate1, currentDate2] %}
                            <tr>
                                <td>{{ profile.id }}</td>
                                <td data-tasma-id="{{ profile.tasma.id }}">{{ profile.tasma.nr_z_etykiety_na_kregu }}</td>
                                <td>{{ profile.data_produkcji }}</td>
                                <td hidden></td>
                                <td>{{ profile.godz_min_rozpoczecia }}</td>
                                <td>{{ profile.godz_min_zakonczenia }}</td>
                                <td>{{ profile.zwrot_na_magazyn_kg }}</td>
                                <td data-szablon_profile-id="{{profile.szablon_profile.id}}">{{ profile.szablon_profile.nazwa }}</td>
                                <td>{{ profile.nazwa_klienta_nr_zlecenia_PRODIO }}</td>
                                <td>{{ profile.ilosc }}</td>
                                <td>{{profile.ilosc_na_stanie}}</td>
                                <td data-dlugosci-id="{{ profile.dlugosci.id }}">{{ profile.dlugosci.nazwa }}</td>
                                <td>{{ profile.tasma.szablon.nazwa }}</td>
                                <td>{{ profile.pracownik.login }} {{profile.imie_nazwisko_pracownika}}</td>
                                <td>
                                    
                                        
                                        {% if not profile.godz_min_zakonczenia %}
                                        <form method="POST" style="display:inline;background-color: transparent;width: 0;padding: 0%;" action="{{ url_for('dodaj_profil_do_bazy') }}">
                                            <!-- Ukryte pole z identyfikatorem profilu -->
                                            <input type="hidden" name="profil_id" value="{{ profile.id }}">
                                            <button type="submit" class="button">Zakończ</button>
                                        </form>
                                        {% else %}
                                        <button type="button" class="button" onclick="openEditModala(this.parentElement.parentElement)">Edytuj</button>
                                        {% endif %}
                                    
                                </td>
                            </tr>
                        {% endif %}
                    
                            
                            {% elif  g.user.id_uprawnienia == 2 %}
                                <tr>
                                    <td>{{ profile.id }}</td>
                                    <td data-tasma-id="{{ profile.tasma.id }}">{{ profile.tasma.nr_z_etykiety_na_kregu }}</td>
                                    <td>{{ profile.data_produkcji }}</td>
                                    <td hidden></td>
                                    <td>{{ profile.godz_min_rozpoczecia }}</td>
                                    <td>{{ profile.godz_min_zakonczenia }}</td>
                                    <td>{{ profile.zwrot_na_magazyn_kg }}</td>
                                    <td data-szblon_profile-id="{{ profile.szablon_profile.id }}">{{ profile.szablon_profile.nazwa }}</td>
                                    <td>{{ profile.nazwa_klienta_nr_zlecenia_PRODIO }}</td>
                                    <td>{{profile.ilosc}}</td>
                                    <td>{{profile.ilosc_na_stanie}}</td>
                                    <td data-dlugosci-id="{{profile.dlugosci.id}}">{{profile.dlugosci.nazwa}}</td>
                                    <td>{{profile.tasma.szablon.nazwa}}</td>
                                    <td>{{ profile.pracownik.login }} {{profile.imie_nazwisko_pracownika}}</td>
                                    
                                    
                                    <td>{% if not profile.godz_min_zakonczenia %}
                                        <form method="POST" style="display:inline;background-color: transparent;width: 0;padding: 0%;" action="{{ url_for('dodaj_profil_do_bazy') }}">
                                            <!-- Ukryte pole z identyfikatorem profilu -->
                                            <input type="hidden" name="profil_id" value="{{ profile.id }}">
                                            <button type="submit" class="button">Zakończ</button>
                                        </form>
                                        {% else %}
                                        <button type="button" class="button" onclick="openEditModala(this.parentElement.parentElement)">Edytuj</button>
                                        {% endif %}
                                        <form method="POST" style="display:inline;background-color: transparent;width: 0;padding: 0%;" action="{{ url_for('usun_profil', id=profile.id) }}" onsubmit="return confirm('Na pewno chcesz usunąć ten materiał?');">
                                            <!-- Ukryte pole z identyfikatorem profilu -->
                                            <input type="hidden" name="profil_id" value="{{ profile.id }}">
                                        <button type="submit" class="button">Usuń</button>
                                    </form></td>
                                </tr>
                                {% elif  g.user.id_uprawnienia == 1 and g.user.id==1%}
                                <tr>
                                    <td>{{ profile.id }}</td>
                                    <td data-tasma-id="{{ profile.tasma.id }}">{{ profile.tasma.nr_z_etykiety_na_kregu }}</td>
                                    <td>{{ profile.data_produkcji }}</td>
                                    <td hidden></td>
                                    <td>{{ profile.godz_min_rozpoczecia }}</td>
                                    <td>{{ profile.godz_min_zakonczenia }}</td>
                                    <td>{{ profile.zwrot_na_magazyn_kg }}</td>
                                    <td data-szblon_profile-id="{{ profile.szablon_profile.id }}">{{ profile.szablon_profile.nazwa }}</td>
                                    <td>{{ profile.nazwa_klienta_nr_zlecenia_PRODIO }}</td>
                                    <td>{{profile.ilosc}}</td>
                                    <td>{{profile.ilosc_na_stanie}}</td>
                                    <td data-dlugosci-id="{{profile.dlugosci.id}}">{{profile.dlugosci.nazwa}}</td>
                                    <td>{{profile.tasma.szablon.nazwa}}</td>
                                    <td>{{ profile.pracownik.login }} {{profile.imie_nazwisko_pracownika}}</td>
                                    
                                    
                                    <td>{% if not profile.godz_min_zakonczenia %}
                                        <form method="POST" style="display:inline;background-color: transparent;width: 0;padding: 0%;" action="{{ url_for('dodaj_profil_do_bazy') }}">
                                            <!-- Ukryte pole z identyfikatorem profilu -->
                                            <input type="hidden" name="profil_id" value="{{ profile.id }}">
                                            <button type="submit" class="button">Zakończ</button>
                                        </form>
                                        {% else %}
                                        <button type="button" class="button" onclick="openEditModala(this.parentElement.parentElement)">Edytuj</button>
                                        {% endif %}
                                        <form method="POST" style="display:inline;background-color: transparent;width: 0;padding: 0%;" action="{{ url_for('usun_profil', id=profile.id) }}" onsubmit="return confirm('Na pewno chcesz usunąć ten materiał?');">
                                            <!-- Ukryte pole z identyfikatorem profilu -->
                                            <input type="hidden" name="profil_id" value="{{ profile.id }}">
                                        <button type="submit" class="button">Usuń</button>
                                    </form></td>
                                </tr>
                                {% elif  g.user.id_uprawnienia == 1 %}
                                <tr>
                                    <td>{{ profile.id }}</td>
                                    <td data-tasma-id="{{ profile.tasma.id }}">{{ profile.tasma.nr_z_etykiety_na_kregu }}</td>
                                    <td>{{ profile.data_produkcji }}</td>
                                    <td hidden></td>
                                    <td>{{ profile.godz_min_rozpoczecia }}</td>
                                    <td>{{ profile.godz_min_zakonczenia }}</td>
                                    <td>{{ profile.zwrot_na_magazyn_kg }}</td>
                                    <td data-szblon_profile-id="{{ profile.szablon_profile.id }}">{{ profile.szablon_profile.nazwa }}</td>
                                    <td>{{ profile.nazwa_klienta_nr_zlecenia_PRODIO }}</td>
                                    <td>{{profile.ilosc}}</td>
                                    <td>{{profile.ilosc_na_stanie}}</td>
                                    <td>{{profile.dlugosci.nazwa}}</td>
                                    <td data-dlugosci-id="{{profile.dlugosci.id}}">{{profile.tasma.szablon.nazwa}}</td>
                                    <td>{{ profile.pracownik.login }} {{profile.imie_nazwisko_pracownika}}</td>
                                    
                                    
                                    <td>{% if not profile.godz_min_zakonczenia %}
                                        <form method="POST" style="display:inline;background-color: transparent;width: 0;padding: 0%;" action="{{ url_for('dodaj_profil_do_bazy') }}">
                                            <!-- Ukryte pole z identyfikatorem profilu -->
                                            <input type="hidden" name="profil_id" value="{{ profile.id }}">
                                            <button type="submit" class="button">Zakończ</button>
                                        </form>
                                        {% else %}
                                        <button type="button" class="button" onclick="openEditModala(this.parentElement.parentElement)">Edytuj</button>
                                        {% endif %}
                                        <form method="POST" style="display:inline;background-color: transparent;width: 0;padding: 0%;" action="{{ url_for('usun_profil', id=profile.id) }}" onsubmit="return confirm('Na pewno chcesz usunąć ten materiał?');">
                                            <!-- Ukryte pole z identyfikatorem profilu -->
                                            <input type="hidden" name="profil_id" value="{{ profile.id }}">
                                        <button type="submit" class="button">Usuń</button>
                                    </form></td>
                                </tr>
                                
                            {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
               </div> 

        </div>
                <hr>
        
        
    </div>
</body>
</html> 