<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile MaxMetal</title>
    <link rel="icon" href="../static/img/logo-duże.png">
    <link rel="stylesheet" href="../static/style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>  <!-- Dodaj jQuery -->

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Funkcja do formatowania czasu z sekundami (HH:MM:SS)
    function formatTimeWithSeconds(date) {
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        const seconds = String(date.getSeconds()).padStart(2, '0');
        return `${hours}:${minutes}:${seconds}`;
    }

    // Ustaw aktualną datę i godzinę rozpoczęcia przy załadowaniu strony
    const now = new Date();
    const today = now.toISOString().split('T')[0]; // Format daty YYYY-MM-DD
    const currentTimeWithSeconds = formatTimeWithSeconds(now);

    // Ustaw wartości pól ukrytych
    document.querySelector('input[name="data_produkcji"]').value = today;
    document.querySelector('input[name="godz_min_rozpoczecia"]').value = currentTimeWithSeconds;

    // Dodanie godziny zakończenia przy wysyłaniu formularza
    const form = document.getElementById('myForm');
    form.addEventListener('submit', function(event) {
        const endTime = new Date();
        document.querySelector('input[name="godz_min_zakonczenia"]').value = formatTimeWithSeconds(endTime);

        // Walidacja wartości zwrotu na magazyn
        const zwrotNaMagazynKg = parseFloat(document.querySelector('input[name="zwrot_na_magazyn_kg"]').value);
        const selectedOption = document.querySelector('select[name="etykieta"]').selectedOptions[0];
        const wagaKreguNaStanie = parseFloat(selectedOption.getAttribute('data-waga-kregu'));

        if (zwrotNaMagazynKg > wagaKreguNaStanie) {
    alert(`Wartość zwrotu na magazyn nie może być większa niż ${wagaKreguNaStanie} kg.`);
    event.preventDefault(); // Zatrzymaj wysyłanie formularza
}
    });
});

// Funkcja do filtrowania etykiet
function filtrujEtykiete() {
    let input = document.getElementById("szukaj_etykiety").value.toLowerCase();
    let select = document.getElementById("etykieta");
    let options = select.getElementsByTagName("option");

    for (let option of options) {
        let text = option.textContent.toLowerCase();
        option.style.display = text.includes(input) ? "" : "none";
    }
}
function filtrujDlugosci() {
    let input = document.getElementById("szukaj_dlugosci").value.toLowerCase();
    let select = document.getElementById("dlugosc");
    let options = select.getElementsByTagName("option");

    for (let option of options) {
        let text = option.textContent.toLowerCase();
        option.style.display = text.includes(input) ? "" : "none";
    }
}
</script>
</head>
<body>
    <div id="strona">
        <form id="myForm" method="POST" action="{{ url_for('dodaj_lub_zakonczenie_profilu') }}">
            {% if not profil %}
                <!-- ROZPOCZĘCIE PROFILU -->
                <h2>Rozpocznij profil</h2>
        
                <label for="etykieta">Etykieta Materiału:</label><br>
<input type="text" id="szukaj_etykiety" onkeyup="filtrujEtykiete()" placeholder="Szukaj etykiety..."><br>
<select id="etykieta" name="etykieta" required>
    {% for tasma in tasmy %}
        <option value="{{ tasma.id }}" >
            {{ tasma.nr_z_etykiety_na_kregu }}
        </option>
    {% endfor %}
</select><br>
        
                <input type="hidden" name="data_produkcji" value="{{ dzisiaj }}">
                <input type="hidden" name="godz_min_rozpoczecia" value="{{ teraz }}">
        
                <label for="nr_czesci_klienta">Nr Części Klienta:</label>
                <input type="text" name="nr_czesci_klienta" required><br>
        
                <label for="nazwa_klienta_nr_zlecenia_PRODIO">Nazwa Klienta / Nr Zlecenia:</label>
                <input type="text" name="nazwa_klienta_nr_zlecenia_PRODIO" required><br>
                <button class="button" type="reset">Wyczyść</button>
                <button class="button" type="submit">Rozpocznij</button>
        
            {% else %}
                <!-- ZAKOŃCZENIE PROFILU -->
                <h2>Zakończ profil #{{ profil.id }}</h2>
                <input type="hidden" name="profil_id" value="{{ profil.id }}">
        
                
                <input type="time" name="godz_min_zakonczenia" value="{{ teraz }}" required hidden><br>
        
                <label for="zwrot_na_magazyn_kg">Zwrot na Magazyn (kg) obecnie {{ilosc}}:</label>
                <input type="number" name="zwrot_na_magazyn_kg" data-waga-kregu="{{ ilosc }}" required><br>
        
                <label for="ilosc">Ilość:</label>
                <input type="number" name="ilosc" required><br>
        
                <label for="dlugosc">Długość:</label><br>
<input type="text" id="szukaj_dlugosci" onkeyup="filtrujDlugosci()" placeholder="Szukaj długości..."><br>
<select id="dlugosc" name="id_dlugosci" required>
    {% for d in dlugosci %}
        <option value="{{ d.id }}">{{ d.nazwa }}</option>
    {% endfor %}
</select><br>
<button class="button" type="reset">Wyczyść</button>
                <button class="button" type="submit">Zakończ</button>
                
            {% endif %}
        </form>

            <!-- <button type="reset" class="button">Wyczyść</button>
            <button type="submit" class="button">Zapisz</button>
        </form> -->
    </div>
</body>
</html>